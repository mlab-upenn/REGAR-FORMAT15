\section{Formal models of the environment}
\label{formalModelsofEnv}
Before over-approximation can be applied, models of different physiological conditions have to be developed to be able to interact with the medical devices. This initial set of physiological models should be able to distinguish the physiological conditions that each model represents. Ideally the models are developed using formalisms that are suitable for provable abstraction and model checking. In this paper, we model different heart conditions with timed-automata models, which serve as the physiological environment of implantable pacemakers. 
\begin{figure}[!t]
	\centering
	\includegraphics[width=0.7\textwidth]{figs/egm.pdf}
	
	%\vspace{-10pt}
	\caption{\small (a) Lead placement for a dual chamber pacemaker (b) Electrogram (EGM) signals from pacemaker leads and corresponding internal event markers}
	\label{fig:probes}
	%\vspace{-15pt}
\end{figure} 
\subsection{Electrophysiology (EP) Basics}
At cellular level, a heart tissue can be activated by external voltage. Certain tissue also has capability to self-activate, which contribute to natural heart beats. Once activated (Marker 1 in \figref{nodepathTA}), the voltage outside the tissue changes over time, which is referred to as \emph{Action Potential} (\figref{nodepathTA}.(a)). The action potential can be divided into two functional timing periods: The \emph{Effective Refractory Period (ERP)}, during which the tissue cannot be triggered by another activation; and the \emph{Rest} period, during which the tissue can be activated and at the end of which the tissue will self-activate. The voltage change of the heart tissue will activate the tissue nearby with certain delay (Marker 2 in \figref{nodepathTA}).  A healthy heart generates periodic electrical impulses to control heart rates according to physiological needs. These impulses conduct through the heart, triggering coordinated muscle contractions and pump blood to the rest of the body. The underlying pattern and timing of these impulses determine the heart's rhythm and are the key to proper heart functions. Derangements in this rhythm are referred to as \emph{arrhythmia}, which impair the heart's ability to pump blood and compromise the patients' health. Arrhythmia are categorized into so-called \textsf{Tachycardia} and \textsf{Bradycardia}. Tachycardia features undesirable fast heart rate which results in inefficient blood pumping. Bradycardia features slow heart rate which results in insufficient blood supply.
Different heart conditions can be distinguished by the timing of generation and conduction of electrical signals, which are researched in clinical setting referred to as \emph{Electrophysiology (EP)}\cite{josephson}.

The implantable cardiac pacemakers are rhythm management devices designed to treat bradycardia. A typical dual chamber pacemaker has two leads inserted into the heart through the veins which can measure the local electrical activities of the right atrium and right ventricle, respectively. According to the timing between sensed impulses the pacemaker can deliver electrical pacing to the corresponding chamber to maintain proper heart rhythm (\figref{probes}).  

\subsection{Timed-automata Models of the Heart}
\label{labeledGraph}
%In a healthy heart, specialized tissue in the \emph{SA node} self-activate periodically. The signal conducts throughout both atria, causing them to contract and push the blood into the ventricles
The timing behaviors of the heart can be modeled as timed automata \cite{timed_automata}. In \cite{VHM_proc} and \cite{sttt13}, we proposed an Electrophysiology heart model to represent the timing behaviors of the electrical conduction system. Heart tissue can be modeled as \emph{Node automata} and the conduction delays between nodes are modeled as \emph{Path automata} (\figref{nodepathTA}). 


The node automaton initializes with \textsf{Rest} state.
From \textsf{Rest} state, the node can either self-activate or be activated by external activations (indicated by Act\_node). Upon activation the node transition to the \textsf{ERP} state and activate all the paths connecting to the node (indicated by Act\_path). 
In the \textsf{ERP} state the node does not respond to external activations. At the end of \textsf{ERP} state the node transition to the \textsf{Rest} state. 
\begin{figure}[!t]
	\centering
	\includegraphics[width=0.9\textwidth]{figs/init_abs.pdf}
	%\vspace{-5pt}
	\caption{\small (a) Action potential for a heart tissue and its tissue nearby (dashed). (b) Node automaton. (c) Path automaton. (d) An example model of the heart consist of a network of node and path automata}
	\label{fig:nodepathTA}
\end{figure}

The initial state of a path automaton is \textsf{Idle}, which corresponds to no conduction. 
A path has two conduction directions, forward and backward.
These are represented by the states Ante and Retro, named after their standard physiological terms Antegrade and Retrograde.
If \textsf{Act\_path} event is received from one of the nodes (1 or 2) connected to the path, the a transition to either \textsf{Ante} or \textsf{Retro} state will occur in the path automaton. 
At the end of \textsf{Ante} and \textsf{Retro} state the path will transition to \textsf{Idle} state and send Act\_node signal to the node automaton connected to the other end of the path (2 or 1).
%A node automaton models the conduction states of heart tissue, and changes therein. 
%Its three states correspond to 3 timing periods of the action potential. 
%From \textsf{Rest} state, the node can either self-activate or be activated by external stimuli (both events are indicated by Act\_node) and transition to the \textsf{ERP} state. 
%In the \textsf{ERP} state the node does not respond to external stimuli because it is refractory. 
%In the \textsf{RRP} state, the node can still be activated and transition to the \textsf{ERP} state.
%But the fact that the activation arrived early (in the RR Period) affects the ERP and the conduction delay of the tissue.  
%%This is tracked by a shared variable $C(i)$ for the $i^{th}$ node automaton. \todo[inline]{what is $C$?}
%%The new ERP period is determined by a function over clock value $g(f(t))$ which mimics the beat-to-beat dynamics described in \cite{josephson}. \todo[inline]{what are $g,f$?}
%
%The electrical conduction through the tissue \emph{between} nodes is abstracted using \emph{path automata}. 
%The path automata are used to represent structural or functional electrical connections between nodes.  
%%At the same time the clock invariant of the state is modified according to the shared variable $C(a/b)$. 
%%This corresponds to the change of the conduction delay that is caused by early activation. 
%Similarly to a node automaton, the changing trend is extracted from clinical data. 
%
%The parameters of the node and path automata determine the ranges of time in which the automata can stay in corresponding locations. 
%The lower endpoint is specified as a clock invariant and the upper endpoint is specified as a guard. 
%For a heart model $G$ with $n$ nodes and $m$ paths (thus, $n$ vertices and $m$ edges), the node automata are denoted as $N_i, i\in[n]$ and path automata are denoted as $P_j,j\in[m]$. 
%\todo[inline]{change to $V_i$ and $E_i$ to stay consistent with definition of graph?}
%The parameters for the nodes are $Trest$ (with range $[Trest_{min}$),TERP,TRRP and the parameters for the paths are $\{Tante,Tretro\}$. 
The spatial and temporal properties of a given human heart condition can be modeled by a network of node and path automata with different parameters (\figref{nodepathTA}.(d)). We use node automata to represent key structures of the heart and the path automata specifies the connectivities of those key structures and the conduction delays among them. The network can be viewed as a labeled directed graph: the vertices of the graph represent nodes, or locations, in the heart, while edges represent conduction paths between the nodes. 
\begin{defn}
	[Labeled graph]
	A \textbf{labeled graph} is a directed graph $G = (V,E,A)$ where 
	$V$ is a finite set of vertices, $E \subset V\times V$ is a finite set of directed edges,
	and $A$ is a total labeling function $A: V \cup E \rightarrow TA$
	where $TA$ is the set of parametrized timed automata.
	The function $A$ labels each vertex with a \emph{node automaton}, and each edge with an \emph{edge automaton}.
	All node (resp. path) automata share the same structure, and differ only in the values of their parameters.
	%The parameters of a timed automaton are variables that appear in the right-hand side of guard and invariant conditions, and whose value can only be changed by a reset that occurs at a transition.	
	%Both node and path automata are shown in Fig.~\ref{fig:nodepathTA}
\end{defn}
The heart model structure has been used to model varies heart conditions and all of them have been validated by Electrophysiologists \cite{vhm_ecrts10,vhm_embc10}.

\subsection{Encoding Physiological Transitions}
Provide physiological context for model behaviors. Useful for requirement encoding and justification of abstraction rules. The behaviors of heart tissue can be categorized into 3 basic transition groups:

\begin{itemize}
	\item \textbf{self:} The self-activation of the node automata. The \emph{min} and \emph{max} properties specify the minimum and maximum intervals between consecutive self-activation events.
	\item \textbf{cond:} The conduction property of the path automata. The \emph{min} and \emph{max} properties specify the minimum and maximum delays between a node activation on one end and the activation on the other end.
	\item \textbf{block:} The blocking property of the node automata. The \emph{min} and \emph{max} properties specify the minimum and maximum intervals between consecutive activations that can trigger path conduction.
\end{itemize}

\subsection{Encoding Physiological Requirements}
Physiological requirements are constraints on physiological behaviors. In \cite{iccps10} we 

\subsection{Monitors}
To simplify the requirement, \cite{iccps10}
%\input{statespaceformulation}