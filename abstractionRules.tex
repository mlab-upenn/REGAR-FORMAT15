\section{Physiological Abstraction rules}
\label{abstractionRules} 
In this section, domain-specific abstraction rules are developed that can introduce new behaviors to a given heart model or set of models. 
These new behaviors are physiologically meaningful and might be manifested by a heart condition not explicitly modeled in the initial set of models.
The physician (or domain expert) remains the ultimate arbiter of what is physiologically meaningful.
This is a peculiarity of environment modeling, borne out of the fact that the initial set of models is necessarily incomplete, and does not represent all valid behaviors.
We then show how the application of these domain-specific rules can be automated, thus obviating the need for domain expertise.

Recall that heart conditions are modeled as finite directed labeled graphs as introduced in Def.~\ref{def:labeledGraph}.
%Let $\Gc$ be the set of labeled graphs, and $2^\Gc$ be the power set of $\Gc$.
%An abstraction rule is a function $2^\Gc \rightarrow \Gc$.
Rules operate on a graph only if it has the appropriate structure for that rule, and if its parameters meet certain rule-specific conditions (if any).
Due to space limits only a subset of the abstraction rules are introduced. 
The full set is in the technical report \cite{regar_tech}.
Proofs that these rules indeed produce over-approximations of the behavior space are relegated to the technical report \cite{regar_tech}.
%\input{rule1}
%\input{rule2}

\subsubsection{Rule R4: Merge Parameter Ranges}
Timing periods of heart tissue, like Rest and ERP, are modeled as locations in the node and path automata. 
The minimum and maximum time an automaton can stay in a location is governed by the parameters in the guards and invariants. 
By expanding these periods, we introduce new behavior where a heart may stay in Rest for longer, or (self-)activate a node faster, etc.
\\
\textbf{(Sub)graph(s) to which it applies}.
This rule applies to a set of graphs $G_i$ with the same structure (i.e., they are pairwise isomorphic) but possibly with different parameters: $R(G_1,\ldots,G_n) = G'$.
See Fig.~\ref{fig:HM_abs}.\\
\textbf{Applicability conditions}.
None.\\
\textbf{Output (sub)graph}.
$G'$ has the same structure as the $G_i$.
Thus there's an isomorphism $f$ between every $G_i$ and $G'$.
Given an element $x$ of $G'$, $f^{-1}(x') = \{x_1,\dots,x_n\}$ are used to represent the set of elements that map to it via $f$, where $x_i \in \Ec(G_i)$.\\
\textbf{Effect on parameters}
%Recall Def.~\ref{def:labeledGraph}
For every automaton $A(x'), x' \in \Ec(G')$, and every parameter $\theta^{x'}$ of $A(x')$, 
$\theta_{min}^{x'} = \min(\theta^x_{min})_{x \in f^{-1}(x') }$ and 
$\theta_{max}^{x'} = \max(\theta^x_{max})_{x \in f^{-1}(x') }$

%\input{rule5}

\subsubsection{Rule R6: Replace Blocking With Non-deterministic Conduction}
%\todo[inline]{in modeling section mention self-activating and passive nodes}
%If a node automaton is in its \textsf{ERP} state, a \textsf{Act\_node} event is "blocked" and will not trigger corresponding path conduction. If we add non-deterministic transitions to the path automata such that a \textsf{Act\_path} event do not trigger state transitions to \textsf{ante} or \textsf{retro} (\figref{rule5}), the blocking behavior of the node is covered. We can then merge the \textsf{ERP} state with the \text{Rest} state in the node automata, and all passive nodes can be removed. An application of Rule 6 is shown in \figref{abs_exam}.\\
Consider the structure $N_1 P_1 N_2 P_2 N_3$ with three nodes and two paths, where $N_2$ is a passive node (i.e. not self-activating).
If $N_2$ blocks an activation signal from $N_1$ to $N_3$, this is equivalent to the paths $P_1$ or $P_2$ not conducting.
In this rule, the structure $P_1 N_2 P_2$ is replaced by a path $P$ whose automaton can take a self loop when it receives an activation signal, thus effectively stopping the conduction. 
This is shown in Fig.~\ref{fig:rule5}: the extra transitions are marked Act\_path\_1? and Act\_path\_2?.
Because the blocking effect of nodes is now incorporated into the paths, the node automata of self-activating nodes can be modified to the one shown in Fig.~\ref{fig:rule5}, which doesn't have the (now useless) ERP period.
\\
\textbf{Subgraph to which it applies}.
Line graphs with 3 vertices $N_1 P_1 N_2 P_2 N_3$, and self-activating nodes.\\
\textbf{Applicability conditions}.
$N_2$ is a passive node.\\
\textbf{Output subgraph}.
$N'_1 P' N'_3$
A path $P'$ whose path automaton is as shown in Fig.~\ref{fig:rule5}.b.
The self-activating nodes $N$ are replaced by nodes $N'$ with automata shown in Fig.~\ref{fig:rule5}.a.\\
\textbf{Effect on parameters}
For the new path, $P.cond_{min}=P_1.cond_{min}+P_2.cond_{min}$ and 
$P.cond_{max}=P_1.cond_{max}+P_2.cond_{max}$
For the new nodes, $N'.Trest_{min}=N.Terp_{min}+N.Trest_{min}$ and 
$N'.Trest_{max}=N.Terp_{max}+N.Trest_{max}$.\\

\begin{figure}[!t]
	\centering
	\includegraphics[width=0.9\textwidth]{figs/rule5.pdf}
	%\vspace{-5pt}
	\caption{\small Node and Path Automata after application of Rule 6 and 7}
	%\vspace{-15pt}
	\label{fig:rule5}
\end{figure}

\subsubsection{Rule R7: Replace Conductions With Self-activation}
The effect of a conduction path is to conduct electrical activity generated by a self-activation node to other nodes. 
If all self-activation nodes are allowed to activate at any time by setting their Rest period to $[0,+\infty]$, all the conduction paths can be removed, while preserving the original behavior (where the Rest period was constrained to a finite interval).
An application of Rule 7 is shown in \figref{abs_exam}.
\textbf{Subgraph to which it applies}.
The entire graph $G$.\\
\textbf{Applicability conditions}.
This rule can only be applied after Rule 5 has been applied.\\
\textbf{Output subraph}.
All edges are deleted: $G' = (V(G), \emptyset)$. The node automata are replaced with the one shown in \figref{rule5}.c.\\
\textbf{Effect on parameters}
For every node automaton $N$ in $G'$, the node automata are $N.Trest_{min}=0,N.Trest_{max} = +\infty$.\\

%\begin{figure}[!h]
%	\centering
%	\includegraphics[width=0.3\textwidth]{figs/rule6.pdf}
%	%\vspace{-5pt}
%	\caption{\small Node automata after application of Rule 7}
%	%\vspace{-15pt}
%	\label{fig:rule6}
%\end{figure}

%\input{automatedApplication}

\subsection{Heart Model Abstraction Tree}
A set of heart models corresponding to different heart conditions are first developed. 
The list can be expanded as new heart conditions are discovered.
Because we start from a set of initial models, and each one may be abstracted using a number of abstraction rules, we have a choice of which rules to apply to which models, and the order in which to apply them.
Depending on which rule is applied when, we end up with different abstract models.
Thus we end with an abstraction tree $T_{HM}$ for the heart is created, as shown in \figref{HM_abs}. 
%Note that applying rules in different order results different abstraction tree. 
%The order used to obtain $HM\_tree$ is based on the domain knowledge that certain heart conditions may have similar behaviors and similar inputs to the pacemaker. 
%This systematic grouping maintains the physiological-relevance of the heart model even at higher abstraction levels, and reduce the necessity to resolve ambiguities at lower abstraction levels when model checking certain requirements.
\begin{figure}[!t]
	\centering
	\includegraphics[width=0.9\textwidth]{figs/abs.pdf}
	%\vspace{-5pt}
	\caption{\small Heart Model Abstraction Tree}
	%\vspace{-15pt}
	\label{fig:HM_abs}
\end{figure}


%\subsection{Rule Application Example}
%In this section we demonstrate 
%\todo[inline]{I don't understand what this is...}
%$$NA\_self=\{SA\_self,AVNRT\_self,AF\_self,PAC\_self\}$$
%$$NV\_self=\{PVC\_self,VF\_self,VT\_self\}$$
%$$(NA,AV')\_cond=\{(SA,AV)\_cond\}$$
%$$(AV',NV)\_cond=\{(AV,RBB)\_cond,RBB-RVA\_cond\}$$
%Apply Rule 6:
%$$NA'\_self=\{NA\_self\}$$
%$$NV'\_self=\{NV\_self\}$$
%$$(NA',NV')\_cond=\{AV'\_block,(NA,AV')\_cond,(AV',NV)\_cond\}$$
%Apply Rule 7:
%$$NA''\_self=\{NA'\_self,(NA',NV')\_cond\}$$
%$$NV''\_self=\{NV'\_self,(NA',NV')\_cond\}$$
%\begin{figure}[!t]
%\centering
%\includegraphics[width=0.9\textwidth]{figs/abs.png}
%%\vspace{-5pt}
%\caption{\small Heart Model Abstractions}
%%\vspace{-15pt}
%\label{fig:abs_exam}
%\end{figure}
